# é¡¹ç›®æ¶æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
file-link-monitor/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡ï¼ˆPython FastAPIï¼‰
â”‚   â”œâ”€â”€ api/                   # APIè·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ category.py       # åˆ†ç±»API
â”‚   â”‚   â”œâ”€â”€ export.py         # å¯¼å‡ºExcel API
â”‚   â”‚   â”œâ”€â”€ mapping.py        # æ˜ å°„ç®¡ç†API
â”‚   â”‚   â”œâ”€â”€ records.py        # é“¾æ¥è®°å½•API
â”‚   â”‚   â”œâ”€â”€ share_link.py     # åˆ†äº«é“¾æ¥ç”ŸæˆAPI
â”‚   â”‚   â”œâ”€â”€ transfer.py       # ğŸ”¥ è½¬å­˜APIï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â””â”€â”€ tree.py           # ç›®å½•æ ‘API
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ unified_transfer.py    # ğŸ”¥ ç»Ÿä¸€è½¬å­˜æœåŠ¡ï¼ˆæ•´åˆOpenList+ä¸‰ç½‘ç›˜ï¼‰
â”‚   â”‚   â””â”€â”€ pan_transfer_api.py    # ç½‘ç›˜è½¬å­˜APIå°è£…
â”‚   â”œâ”€â”€ utils/                # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ linker.py         # ç¡¬é“¾æ¥å·¥å…·
â”‚   â”‚   â”œâ”€â”€ obfuscator.py     # æ–‡ä»¶åæ··æ·†
â”‚   â”‚   â”œâ”€â”€ baidu_api.py      # ç™¾åº¦ç½‘ç›˜API
â”‚   â”‚   â”œâ”€â”€ quark_api.py      # å¤¸å…‹ç½‘ç›˜API
â”‚   â”‚   â””â”€â”€ xunlei_api.py     # è¿…é›·ç½‘ç›˜API
â”‚   â”œâ”€â”€ tests/                # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ migrations/           # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ models.py             # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ monitor.py            # æ–‡ä»¶ç›‘æ§æœåŠ¡
â”‚   â””â”€â”€ main.py               # ä¸»å…¥å£
â”œâ”€â”€ frontend-vue/             # å‰ç«¯æºç ï¼ˆVue 3 + Element Plusï¼‰
â”‚   â””â”€â”€ src/views/MappingManage.vue  # ğŸ”¥ æ˜ å°„ç®¡ç†é¡µé¢
â”œâ”€â”€ frontend/                 # å‰ç«¯ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â””â”€â”€ config.yaml               # é…ç½®æ–‡ä»¶
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯ (Vue 3)                  â”‚
â”‚  - MappingManage.vue (æ˜ å°„ç®¡ç†+è½¬å­˜)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         APIå±‚ (FastAPI)                 â”‚
â”‚  - transfer.py (è½¬å­˜è·¯ç”±)                â”‚
â”‚  - mapping.py (æ˜ å°„CRUD)                 â”‚
â”‚  - category.py (åˆ†ç±»åˆ—è¡¨)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       æœåŠ¡å±‚ (Business Logic)           â”‚
â”‚  - UnifiedTransfer (ç»Ÿä¸€è½¬å­˜)            â”‚
â”‚    â”œâ”€ OpenListç›®å½•ç®¡ç†                   â”‚
â”‚    â”œâ”€ è‡ªåŠ¨åˆ›å»ºç›®å½•                       â”‚
â”‚    â””â”€ ä¸‰ç½‘ç›˜è½¬å­˜APIè°ƒç”¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®å±‚ (SQLAlchemy ORM)            â”‚
â”‚  - CustomNameMapping (æ˜ å°„è¡¨)           â”‚
â”‚  - PanCookie (ç½‘ç›˜è®¤è¯)                 â”‚
â”‚  - LinkRecord (é“¾æ¥è®°å½•)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½ï¼šåˆ†ç±»è½¬å­˜

### å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·åœ¨å‰ç«¯ç‚¹å‡»"ç›˜æœ"
   â†“
2. æœç´¢ç»“æœå±•ç¤ºï¼ˆç™¾åº¦/å¤¸å…‹/è¿…é›·ï¼‰
   â†“
3. ç”¨æˆ·ç‚¹å‡»"è½¬å­˜"æŒ‰é’®
   â†“
4. å‰ç«¯è°ƒç”¨ POST /api/transfer
   {
     share_url: "åˆ†äº«é“¾æ¥",
     pass_code: "æå–ç ",
     target_path: "/A-é—²é±¼å½±è§†/å‰§é›†/æ—¥éŸ©å‰§é›†/æ¨¡èŒƒå‡ºç§Ÿè½¦",
     pan_type: "baidu",
     use_openlist: true
   }
   â†“
5. åç«¯ transfer.py æ¥æ”¶è¯·æ±‚
   â†“
6. è°ƒç”¨ UnifiedTransfer.transfer()
   â”œâ”€ æ£€æµ‹ç½‘ç›˜ç±»å‹
   â”œâ”€ é€šè¿‡OpenListæ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
   â”œâ”€ ä¸å­˜åœ¨åˆ™ä¸€å±‚ä¸€å±‚åˆ›å»ºç›®å½•
   â”œâ”€ è·å–è½¬å­˜å‚æ•°ï¼ˆç™¾åº¦ç”¨è·¯å¾„ï¼Œå¤¸å…‹/è¿…é›·ç”¨IDï¼‰
   â””â”€ è°ƒç”¨ç½‘ç›˜APIæ‰§è¡Œè½¬å­˜
   â†“
7. è¿”å›ç»“æœç»™å‰ç«¯
   {
     success: true,
     file_count: 16,
     message: "è½¬å­˜æˆåŠŸ"
   }
```

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. è‡ªåŠ¨ç›®å½•åˆ›å»º
```python
# unified_transfer.py: get_transfer_param()
# ä¸€å±‚ä¸€å±‚æ£€æŸ¥ç›®å½•ï¼Œä¸å­˜åœ¨å°±é€šè¿‡OpenList APIåˆ›å»º
for part in path_parts:
    if not exists(part):
        _create_directory(part)
```

#### 2. æå–ç è§£æ
```javascript
// MappingManage.vue: confirmTransferFromPansou()
// å¦‚æœpasswordå­—æ®µä¸ºç©ºï¼Œä»URLè§£æ
if (!passCode) {
    const match = shareUrl.match(/pwd=([a-zA-Z0-9]+)/);
    passCode = match ? match[1] : '';
}
```

#### 3. æ˜ å°„åŒ¹é…
```javascript
// ä¼˜å…ˆä½¿ç”¨currentMappingï¼ˆä»åˆ—è¡¨ç‚¹å‡»ç›˜æœï¼‰
// æ²¡æœ‰åˆ™ç”¨æ¨¡ç³ŠåŒ¹é…æŸ¥æ‰¾
let mapping = currentMapping.value || 
              mappings.value.find(m => m.original_name.includes(keyword));
const category = mapping?.category || 'æœªåˆ†ç±»';
```

## ğŸ“‹ æ•°æ®åº“è®¾è®¡

### custom_name_mapping (æ˜ å°„è¡¨)
```sql
id              INT PRIMARY KEY
original_name   VARCHAR(500)  -- åŸå§‹åç§°
category        VARCHAR(100)  -- ğŸ†• äºŒçº§åˆ†ç±»ï¼ˆå¦‚ï¼šå‰§é›†/æ—¥éŸ©å‰§é›†ï¼‰
quark_name      VARCHAR(500)  -- å¤¸å…‹ç½‘ç›˜åç§°
baidu_name      VARCHAR(500)  -- ç™¾åº¦ç½‘ç›˜åç§°
xunlei_name     VARCHAR(500)  -- è¿…é›·ç½‘ç›˜åç§°
enabled         BOOLEAN       -- æ˜¯å¦å¯ç”¨
is_completed    BOOLEAN       -- æ˜¯å¦å®Œç»“
baidu_link      TEXT          -- ç™¾åº¦åˆ†äº«é“¾æ¥
quark_link      TEXT          -- å¤¸å…‹åˆ†äº«é“¾æ¥
xunlei_link     TEXT          -- è¿…é›·åˆ†äº«é“¾æ¥
```

### pan_cookie (ç½‘ç›˜è®¤è¯)
```sql
id          INT PRIMARY KEY
pan_type    VARCHAR(20)   -- baidu/quark/xunlei
cookie      TEXT          -- Cookieæˆ–Token
is_active   BOOLEAN       -- æ˜¯å¦å¯ç”¨
```

## ğŸ”§ é…ç½®è¯´æ˜

### OpenListé…ç½®
```python
# unified_transfer.py
OPENLIST_URL = "http://10.10.10.17:5255"
OPENLIST_TOKEN = "openlist-xxx..."

# ç½‘ç›˜æŒ‚è½½ç‚¹æ˜ å°„
PAN_MOUNT_MAP = {
    'baidu': 'baidu',
    'quark': 'kuake',  # OpenListä¸­çš„å¤¸å…‹æŒ‚è½½å
    'xunlei': 'xunlei'
}
```

### åˆ†ç±»é…ç½®
- æ¥æºï¼š`/api/categories` æ¥å£
- æ•°æ®æºï¼š`äºŒçº§åˆ†ç±».yaml` æ–‡ä»¶è§£æ
- ç»“æ„ï¼šä¸€çº§åˆ†ç±» â†’ äºŒçº§åˆ†ç±»åˆ—è¡¨

## ğŸš€ å¯åŠ¨æ–¹å¼

### åç«¯
```bash
cd file-link-monitor
python3 -m uvicorn backend.main:app --host 0.0.0.0 --port 8082
```

### å‰ç«¯å¼€å‘
```bash
cd frontend-vue
npm run dev
```

### å‰ç«¯ç”Ÿäº§æ„å»º
```bash
cd frontend-vue
npm run build
cp -r dist/* ../frontend/
```

- `GET /api/categories` - è·å–åˆ†ç±»åˆ—è¡¨

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¶…æ—¶è®¾ç½®**ï¼šè½¬å­˜APIè®¾ç½®60ç§’è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡
2. **ç›®å½•è‡ªåŠ¨åˆ›å»º**ï¼šæ‰€æœ‰ç½‘ç›˜ç±»å‹ï¼ˆç™¾åº¦/å¤¸å…‹/è¿…é›·ï¼‰éƒ½æ”¯æŒ
3. **æå–ç è§£æ**ï¼šä¼˜å…ˆä½¿ç”¨passwordå­—æ®µï¼Œä¸ºç©ºåˆ™ä»URLè§£æ
4. **æ¨¡ç³ŠåŒ¹é…**ï¼šç›˜æœå…³é”®è¯ä¸æ˜ å°„åç§°æ”¯æŒåŒ…å«åŒ¹é…
