# åˆ†äº«é“¾æ¥æ£€æŸ¥å™¨ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

åˆ†äº«é“¾æ¥æ£€æŸ¥å™¨æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æœåŠ¡ï¼Œç”¨äºï¼š
- å®šæœŸæ£€æŸ¥æ•°æ®åº“ä¸­å“ªäº›èµ„æºè¿˜æ²¡æœ‰ç”Ÿæˆåˆ†äº«é“¾æ¥
- æŒ‰ç½‘ç›˜ç±»å‹ï¼ˆç™¾åº¦/å¤¸å…‹/è¿…é›·ï¼‰åˆ†åˆ«ç»Ÿè®¡
- é€šè¿‡ä¼ä¸šå¾®ä¿¡æ¨é€æ£€æŸ¥æŠ¥å‘Š
- æä¾›APIæ¥å£ä¾›æ‰‹åŠ¨è§¦å‘å’ŒæŸ¥è¯¢

## é…ç½®

åœ¨ `config.yaml` ä¸­é…ç½®ï¼š

```yaml
# åˆ†äº«é“¾æ¥æ£€æŸ¥å™¨é…ç½®
share_link_checker:
  enabled: true              # æ˜¯å¦å¯ç”¨æ£€æŸ¥å™¨
  check_interval_hours: 24   # æ£€æŸ¥é—´éš”ï¼ˆå°æ—¶ï¼‰
```

### æ£€æŸ¥é—´éš”è¯´æ˜

- `24`: æ¯å¤©æ£€æŸ¥ä¸€æ¬¡ï¼ˆ9ç‚¹ï¼‰
- `12`: æ¯å¤©æ£€æŸ¥ä¸¤æ¬¡ï¼ˆ9ç‚¹ã€21ç‚¹ï¼‰
- `8`: æ¯å¤©æ£€æŸ¥ä¸‰æ¬¡ï¼ˆ9ç‚¹ã€17ç‚¹ã€å‡Œæ™¨1ç‚¹ï¼‰
- `6`: æ¯4å°æ—¶æ£€æŸ¥ä¸€æ¬¡
- `4`: æ¯4å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼ˆæ›´é¢‘ç¹ï¼‰

## API ç«¯ç‚¹

### 1. æ‰‹åŠ¨è§¦å‘æ£€æŸ¥

**POST** `/api/check-missing-links`

æ£€æŸ¥æ‰€æœ‰ç¼ºå¤±çš„åˆ†äº«é“¾æ¥ï¼Œå¹¶å¯é€‰æ‹©æ˜¯å¦å‘é€å¾®ä¿¡é€šçŸ¥ã€‚

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "send_notification": true  // æ˜¯å¦å‘é€å¾®ä¿¡é€šçŸ¥ï¼Œé»˜è®¤true
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "check_time": "2025-12-29T10:30:00",
  "total_mappings": 150,
  "missing_counts": {
    "baidu": 25,
    "quark": 18,
    "xunlei": 32,
    "all_missing": 10
  },
  "missing_links": {
    "baidu": [
      {
        "id": 1,
        "name": "åŠ æ²¹ï¼Œä½ æ˜¯æœ€æ£’çš„ (2019)",
        "category": "ç”µè§†å‰§/å›½äº§å‰§é›†",
        "completed": false
      }
    ],
    "quark": [...],
    "xunlei": [...],
    "all_missing": [...]
  }
}
```

### 2. æŒ‰ç½‘ç›˜ç±»å‹æŸ¥è¯¢ç¼ºå¤±é“¾æ¥

**GET** `/api/missing-links/{pan_type}`

è·å–æŒ‡å®šç½‘ç›˜ç±»å‹ç¼ºå¤±é“¾æ¥çš„èµ„æºåˆ—è¡¨ï¼ŒæŒ‰åˆ†ç±»åˆ†ç»„ã€‚

**è·¯å¾„å‚æ•°**ï¼š
- `pan_type`: ç½‘ç›˜ç±»å‹
  - `baidu`: ç™¾åº¦ç½‘ç›˜
  - `quark`: å¤¸å…‹ç½‘ç›˜
  - `xunlei`: è¿…é›·ç½‘ç›˜
  - `all`: ä¸‰ä¸ªç½‘ç›˜éƒ½æ²¡æœ‰é“¾æ¥çš„

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "pan_type": "baidu",
  "total_count": 25,
  "categories": {
    "ç”µè§†å‰§/å›½äº§å‰§é›†": [
      {
        "id": 1,
        "original_name": "åŠ æ²¹ï¼Œä½ æ˜¯æœ€æ£’çš„ (2019)",
        "category": "ç”µè§†å‰§/å›½äº§å‰§é›†",
        "is_completed": false,
        "baidu_name": "åŠ æ²¹ä½ æ˜¯æœ€æ£’çš„",
        "quark_name": "åŠ æ²¹ä½ æ˜¯æœ€æ£’çš„",
        "xunlei_name": "åŠ æ²¹ä½ æ˜¯æœ€æ£’çš„",
        "has_baidu_link": false,
        "has_quark_link": true,
        "has_xunlei_link": true
      }
    ],
    "ç”µå½±/æ¬§ç¾ç”µå½±": [...]
  },
  "check_time": "2025-12-29T10:30:00"
}
```

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ—¥å¸¸ç›‘æ§

ç³»ç»Ÿä¼šæ ¹æ®é…ç½®çš„æ£€æŸ¥é—´éš”è‡ªåŠ¨è¿è¡Œï¼Œé€šè¿‡ä¼ä¸šå¾®ä¿¡æ¨é€æŠ¥å‘Šï¼š

```
ğŸ”— åˆ†äº«é“¾æ¥æ£€æŸ¥æŠ¥å‘Š

ğŸ“Š èµ„æºæ€»æ•°: 150ä¸ª

ğŸ“‰ ç¼ºå¤±é“¾æ¥ç»Ÿè®¡:
  ç™¾åº¦ç½‘ç›˜: 25ä¸ª
  å¤¸å…‹ç½‘ç›˜: 18ä¸ª
  è¿…é›·ç½‘ç›˜: 32ä¸ª
  å…¨éƒ¨ç¼ºå¤±: 10ä¸ª

âš ï¸ ä»¥ä¸‹èµ„æºå°šæœªç”Ÿæˆä»»ä½•åˆ†äº«é“¾æ¥:

ã€ç”µè§†å‰§/å›½äº§å‰§é›†ã€‘
ğŸ”„ åŠ æ²¹ï¼Œä½ æ˜¯æœ€æ£’çš„ (2019)
âœ… åº†ä½™å¹´ (2019)
... è¿˜æœ‰8ä¸ª

â° æ£€æŸ¥æ—¶é—´: 2025-12-29 10:30

ğŸ’¡ æç¤º: å¯é€šè¿‡APIæ‰‹åŠ¨ç”Ÿæˆç¼ºå¤±çš„é“¾æ¥
```

### åœºæ™¯2: æ‰‹åŠ¨è§¦å‘æ£€æŸ¥

å½“ä½ éœ€è¦ç«‹å³æ£€æŸ¥æ—¶ï¼Œå¯ä»¥è°ƒç”¨APIï¼š

```bash
# è§¦å‘æ£€æŸ¥å¹¶å‘é€é€šçŸ¥
curl -X POST http://localhost:8080/api/check-missing-links

# è§¦å‘æ£€æŸ¥ä½†ä¸å‘é€é€šçŸ¥
curl -X POST http://localhost:8080/api/check-missing-links?send_notification=false
```

### åœºæ™¯3: æŸ¥è¯¢ç‰¹å®šç½‘ç›˜çš„ç¼ºå¤±é“¾æ¥

```bash
# æŸ¥è¯¢ç™¾åº¦ç½‘ç›˜ç¼ºå¤±é“¾æ¥
curl http://localhost:8080/api/missing-links/baidu

# æŸ¥è¯¢å¤¸å…‹ç½‘ç›˜ç¼ºå¤±é“¾æ¥
curl http://localhost:8080/api/missing-links/quark

# æŸ¥è¯¢è¿…é›·ç½‘ç›˜ç¼ºå¤±é“¾æ¥
curl http://localhost:8080/api/missing-links/xunlei

# æŸ¥è¯¢ä¸‰ä¸ªç½‘ç›˜éƒ½æ²¡æœ‰çš„èµ„æº
curl http://localhost:8080/api/missing-links/all
```

### åœºæ™¯4: æ‰¹é‡ç”Ÿæˆç¼ºå¤±é“¾æ¥

ç»“åˆç°æœ‰çš„åˆ†äº«é“¾æ¥ç”ŸæˆAPIï¼Œå¯ä»¥æ‰¹é‡ç”Ÿæˆç¼ºå¤±çš„é“¾æ¥ï¼š

```bash
# 1. å…ˆæŸ¥è¯¢å“ªäº›èµ„æºç¼ºå¤±ç™¾åº¦é“¾æ¥
curl http://localhost:8080/api/missing-links/baidu

# 2. æ‰¹é‡ç”Ÿæˆç™¾åº¦é“¾æ¥ï¼ˆä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰æ²¡æœ‰é“¾æ¥çš„ï¼‰
curl -X POST http://localhost:8080/api/generate-link \
  -H "Content-Type: application/json" \
  -d '{
    "pan_type": "baidu"
  }'
```

## å‰ç«¯é›†æˆå»ºè®®

### 1. æ·»åŠ æ£€æŸ¥æŒ‰é’®

åœ¨å‰ç«¯åˆ†äº«é“¾æ¥ç®¡ç†é¡µé¢æ·»åŠ ä¸€ä¸ª"æ£€æŸ¥ç¼ºå¤±é“¾æ¥"æŒ‰é’®ï¼š

```javascript
async function checkMissingLinks() {
  try {
    const response = await fetch('/api/check-missing-links', {
      method: 'POST'
    });
    const result = await response.json();
    
    if (result.success) {
      alert(`æ£€æŸ¥å®Œæˆï¼š
        æ€»èµ„æº: ${result.total_mappings}ä¸ª
        ç¼ºå¤±ç™¾åº¦: ${result.missing_counts.baidu}ä¸ª
        ç¼ºå¤±å¤¸å…‹: ${result.missing_counts.quark}ä¸ª
        ç¼ºå¤±è¿…é›·: ${result.missing_counts.xunlei}ä¸ª
        å…¨éƒ¨ç¼ºå¤±: ${result.missing_counts.all_missing}ä¸ª
      `);
    }
  } catch (error) {
    alert('æ£€æŸ¥å¤±è´¥: ' + error.message);
  }
}
```

### 2. æ˜¾ç¤ºç¼ºå¤±é“¾æ¥åˆ—è¡¨

åˆ›å»ºä¸€ä¸ªé¡µé¢å±•ç¤ºç¼ºå¤±é“¾æ¥ï¼š

```javascript
async function loadMissingLinks(panType = 'all') {
  try {
    const response = await fetch(`/api/missing-links/${panType}`);
    const result = await response.json();
    
    if (result.success) {
      // æŒ‰åˆ†ç±»å±•ç¤º
      for (const [category, items] of Object.entries(result.categories)) {
        console.log(`${category}: ${items.length}ä¸ªèµ„æº`);
        // æ¸²æŸ“åˆ°é¡µé¢...
      }
    }
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
  }
}
```

## é€šçŸ¥æ¶ˆæ¯æ ¼å¼

æ£€æŸ¥å™¨ä¼šå‘é€è¯¦ç»†çš„æŠ¥å‘Šåˆ°ä¼ä¸šå¾®ä¿¡ï¼š

- âœ… å·²å®Œç»“å‰§é›†ï¼ˆç»¿è‰²å‹¾ï¼‰
- ğŸ”„ æœªå®Œç»“å‰§é›†ï¼ˆè“è‰²ç®­å¤´ï¼‰
- æŒ‰åˆ†ç±»åˆ†ç»„å±•ç¤º
- æœ€å¤šæ˜¾ç¤ºå‰20ä¸ªèµ„æº
- æ˜¾ç¤ºæ¯ä¸ªåˆ†ç±»çš„å‰5ä¸ª

## æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡å¯åŠ¨**ï¼šé¦–æ¬¡å¯åŠ¨åä¼šåœ¨é…ç½®çš„æ—¶é—´ç‚¹æ‰§è¡Œç¬¬ä¸€æ¬¡æ£€æŸ¥
2. **å¾®ä¿¡é€šçŸ¥**ï¼šéœ€è¦æ­£ç¡®é…ç½®ä¼ä¸šå¾®ä¿¡æ‰èƒ½æ”¶åˆ°é€šçŸ¥
3. **æ€§èƒ½è€ƒè™‘**ï¼šå¦‚æœèµ„æºæ•°é‡å¾ˆå¤šï¼Œå»ºè®®é€‚å½“å¢åŠ æ£€æŸ¥é—´éš”
4. **æ•°æ®å‡†ç¡®æ€§**ï¼šåªæ£€æŸ¥ `enabled=true` çš„æ˜ å°„è®°å½•
5. **é“¾æ¥åˆ¤æ–­**ï¼šç©ºå­—ç¬¦ä¸²å’ŒNULLéƒ½è§†ä¸ºæ²¡æœ‰é“¾æ¥

## æ•…éšœæ’é™¤

### æ£€æŸ¥å™¨æœªå¯åŠ¨

æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰ä»¥ä¸‹ä¿¡æ¯ï¼š
```
âœ… åˆ†äº«é“¾æ¥æ£€æŸ¥å™¨å·²å¯åŠ¨ (é—´éš”: 24å°æ—¶)
```

å¦‚æœçœ‹åˆ°ï¼š
```
â¸ï¸  åˆ†äº«é“¾æ¥æ£€æŸ¥å™¨å·²ç¦ç”¨
```

è¯´æ˜é…ç½®ä¸­ `enabled: false`ï¼Œéœ€è¦ä¿®æ”¹é…ç½®å¹¶é‡å¯ã€‚

### æ— æ³•æ”¶åˆ°é€šçŸ¥

1. æ£€æŸ¥ä¼ä¸šå¾®ä¿¡é…ç½®æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ `default_user` æ˜¯å¦é…ç½®
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### API è¿”å›503é”™è¯¯

è¯´æ˜æ£€æŸ¥å™¨æœªå¯åŠ¨æˆ–å¯åŠ¨å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
1. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
2. å¯åŠ¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
3. æ˜¯å¦éœ€è¦é‡å¯æœåŠ¡

## å®Œæ•´ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµç¨‹

```bash
# 1. æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
curl -X POST http://localhost:8080/api/check-missing-links

# 2. æŸ¥çœ‹å…¨éƒ¨ç¼ºå¤±çš„èµ„æº
curl http://localhost:8080/api/missing-links/all

# 3. æ‰¹é‡ç”Ÿæˆç™¾åº¦ç½‘ç›˜é“¾æ¥
curl -X POST http://localhost:8080/api/generate-link \
  -H "Content-Type: application/json" \
  -d '{"pan_type": "baidu"}'

# 4. æ‰¹é‡ç”Ÿæˆå¤¸å…‹ç½‘ç›˜é“¾æ¥
curl -X POST http://localhost:8080/api/generate-link \
  -H "Content-Type: application/json" \
  -d '{"pan_type": "quark"}'

# 5. æ‰¹é‡ç”Ÿæˆè¿…é›·ç½‘ç›˜é“¾æ¥
curl -X POST http://localhost:8080/api/generate-link \
  -H "Content-Type: application/json" \
  -d '{"pan_type": "xunlei"}'

# 6. å†æ¬¡æ£€æŸ¥ç¡®è®¤
curl -X POST http://localhost:8080/api/check-missing-links
```

## æœªæ¥æ‰©å±•

å¯èƒ½çš„æ‰©å±•åŠŸèƒ½ï¼š
- [ ] æ”¯æŒæŒ‰å®Œç»“çŠ¶æ€ç­›é€‰
- [ ] æ”¯æŒå¯¼å‡ºç¼ºå¤±é“¾æ¥æŠ¥è¡¨
- [ ] è‡ªåŠ¨æ‰¹é‡ç”Ÿæˆç¼ºå¤±é“¾æ¥
- [ ] é“¾æ¥æœ‰æ•ˆæ€§æ£€æŸ¥
- [ ] å†å²è¶‹åŠ¿ç»Ÿè®¡

## ç›¸å…³æ–‡æ¡£

- [åˆ†äº«é“¾æ¥ç”ŸæˆAPI](./API_USAGE.md)
- [ä¼ä¸šå¾®ä¿¡é…ç½®æŒ‡å—](./wechat_setup.md)

